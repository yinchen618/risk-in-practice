# å¤šå°ºåº¦æ™‚é–“çª—å£ç‰¹å¾µæå– API æŒ‡å—

## ğŸ¯ æ¦‚è¿°

é€™å€‹å¢å¼·ç‰ˆçš„ nnPU è¨“ç·´ API æ”¯æŒåŸºæ–¼å‰ç«¯æ»‘æ¡¿è¨­å®šçš„å¤šå°ºåº¦æ™‚é–“çª—å£ç‰¹å¾µæå–ã€‚ç”¨æˆ¶å¯ä»¥é€šéèª¿æ•´ "Data Preparation" æ»‘æ¡¿ä¾†æ§åˆ¶ç‰¹å¾µå·¥ç¨‹çš„æ™‚é–“çª—å£å¤§å°ã€‚

## ğŸ“ æ™‚é–“çª—å£è¨ˆç®—é‚è¼¯

ç•¶ç”¨æˆ¶è¨­å®šä¸»è¦æ™‚é–“çª—å£ç‚º `N` åˆ†é˜æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•è¨ˆç®—ï¼š

- **çŸ­æœŸçª—å£ (Short Window)** = `N Ã· 2` åˆ†é˜ (æœ€å°15åˆ†é˜)
- **ä¸­æœŸçª—å£ (Medium Window)** = `N` åˆ†é˜ (ç”¨æˆ¶è¨­å®šå€¼)
- **é•·æœŸçª—å£ (Long Window)** = `N Ã— 4` åˆ†é˜

### ç¯„ä¾‹ï¼š
- ç”¨æˆ¶è¨­å®š 60 åˆ†é˜ â†’ çŸ­æœŸ30åˆ†é˜, ä¸­æœŸ60åˆ†é˜, é•·æœŸ240åˆ†é˜
- ç”¨æˆ¶è¨­å®š 90 åˆ†é˜ â†’ çŸ­æœŸ45åˆ†é˜, ä¸­æœŸ90åˆ†é˜, é•·æœŸ360åˆ†é˜
- ç”¨æˆ¶è¨­å®š 30 åˆ†é˜ â†’ çŸ­æœŸ15åˆ†é˜, ä¸­æœŸ30åˆ†é˜, é•·æœŸ120åˆ†é˜

## ğŸš€ API ä½¿ç”¨æ–¹æ³•

### å‰µå»ºè¨“ç·´æ¨¡å‹ API

**ç«¯é»**: `POST /api/v2/training-jobs`

**è«‹æ±‚ Body ç¯„ä¾‹**:

```json
{
  "model_name": "å¤šå°ºåº¦ç‰¹å¾µ nnPU æ¨¡å‹",
  "scenario_type": "ERM_BASELINE", 
  "experiment_run_id": "æ‚¨çš„å¯¦é©—ID",
  "training_config": {
    "algorithm": "nnPU",
    "epochs": 50,
    "learning_rate": 0.001,
    "hidden_dim": 128,
    "feature_engineering": {
      "main_window_size_minutes": 60  // ğŸ¯ ä¾†è‡ªå‰ç«¯æ»‘æ¡¿çš„å€¼
    }
  },
  "data_source_config": {
    "use_analysis_ready_data": true
  }
}
```

### å‰ç«¯é›†æˆç¤ºä¾‹

```typescript
// å‡è¨­å‰ç«¯æœ‰ä¸€å€‹æ»‘æ¡¿çµ„ä»¶
const timeWindowSlider = 60; // ç”¨æˆ¶è¨­å®šçš„åˆ†é˜æ•¸

const trainingRequest = {
  model_name: `æ™‚é–“çª—å£${timeWindowSlider}åˆ†é˜-nnPUæ¨¡å‹`,
  scenario_type: "ERM_BASELINE",
  experiment_run_id: currentExperimentId,
  training_config: {
    algorithm: "nnPU",
    epochs: 50,
    learning_rate: 0.001,
    hidden_dim: 128,
    feature_engineering: {
      main_window_size_minutes: timeWindowSlider // ğŸ¯ é—œéµåƒæ•¸
    }
  },
  data_source_config: {
    use_analysis_ready_data: true
  }
};

// ç™¼é€è¨“ç·´è«‹æ±‚
fetch('/api/v2/training-jobs', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(trainingRequest)
});
```

## ğŸ“Š ç‰¹å¾µå‘é‡çµæ§‹

æ–°çš„å¤šå°ºåº¦ç‰¹å¾µæå–æœƒç”¢ç”Ÿ **33 ç¶­ç‰¹å¾µå‘é‡**ï¼š

### åŸºç¤ç‰¹å¾µ (5 ç¶­)
1. åŸå§‹L1åŠŸç‡
2. åŸå§‹L2åŠŸç‡  
3. 110VåŠŸç‡
4. 220VåŠŸç‡
5. ç¸½åŠŸç‡

### æ™‚é–“çª—å£çµ±è¨ˆç‰¹å¾µ (24 ç¶­)
æ¯å€‹çª—å£ (çŸ­æœŸ/ä¸­æœŸ/é•·æœŸ) å„è‡ªè¨ˆç®— 8 å€‹çµ±è¨ˆç‰¹å¾µï¼š
- å¹³å‡åŠŸç‡ã€åŠŸç‡æ¨™æº–å·®ã€æœ€å¤§åŠŸç‡ã€æœ€å°åŠŸç‡
- ä¸­ä½æ•¸åŠŸç‡ã€é«˜åŠŸç‡äº‹ä»¶è¨ˆæ•¸ã€L1-L2å¹³å‡å·®å€¼ã€è®ŠåŒ–åŠ‡çƒˆç¨‹åº¦

### è·¨çª—å£æ¯”è¼ƒç‰¹å¾µ (4 ç¶­)
- çŸ­æœŸ/ä¸­æœŸåŠŸç‡æ¯”ç‡
- ä¸­æœŸ/é•·æœŸåŠŸç‡æ¯”ç‡
- çŸ­æœŸ/é•·æœŸåŠŸç‡æ¯”ç‡
- çŸ­æœŸvsä¸­æœŸè®Šç•°æ€§æ¯”ç‡

## ğŸ¯ è¨“ç·´çµæœç¤ºä¾‹

```json
{
  "algorithm": "nnPU",
  "epochs": 20,
  "learning_rate": 0.01,
  "hidden_dim": 64,
  "final_risk": 0.0,
  "p_samples": 1191,
  "u_samples": 5000,
  "class_prior": 0.192,
  "mean_prediction": 0.932,
  "std_prediction": 0.156,
  "feature_dimensions": 33,
  "window_config": {
    "short_window": 45,
    "medium_window": 90, 
    "long_window": 360
  }
}
```

## âœ… æˆåŠŸæ¸¬è©¦æ¡ˆä¾‹

- âœ… **60åˆ†é˜çª—å£**: 1,191 æ­£æ¨£æœ¬, 5,000 æœªæ¨™è¨˜æ¨£æœ¬, 10ç¶­ â†’ 33ç¶­ç‰¹å¾µ
- âœ… **90åˆ†é˜çª—å£**: 1,191 æ­£æ¨£æœ¬, 5,000 æœªæ¨™è¨˜æ¨£æœ¬, 33ç¶­ç‰¹å¾µ, è¨“ç·´æˆåŠŸ

## ğŸ”§ æŠ€è¡“å„ªåŒ–

1. **æ™‚é–“ç´¢å¼•**: å»ºç«‹é«˜æ•ˆçš„æ™‚é–“æˆ³ç´¢å¼•å­—å…¸ï¼Œæå‡çª—å£æŸ¥è©¢æ•ˆç‡
2. **å®¹éŒ¯è™•ç†**: ç•¶çª—å£å…§æ¨£æœ¬ä¸è¶³æ™‚ï¼Œä½¿ç”¨ç•¶å‰å€¼é€²è¡Œæ™ºèƒ½å¡«å……
3. **è¨˜æ†¶é«”å„ªåŒ–**: åˆ†æ‰¹è™•ç†å¤§é‡æ¨£æœ¬ï¼Œé¿å…è¨˜æ†¶é«”æº¢å‡º
4. **WebSocket å›é¥‹**: å¯¦æ™‚é¡¯ç¤ºç‰¹å¾µæå–é€²åº¦å’Œçª—å£é…ç½®è³‡è¨Š

é€™å€‹å¢å¼·ç‰ˆç‰¹å¾µæå–åŠŸèƒ½ï¼Œè®“æ‚¨çš„ PU Learning æ¨¡å‹èƒ½å¤ æ•æ‰åˆ°æ›´è±å¯Œçš„æ™‚é–“åºåˆ—æ¨¡å¼ï¼Œå¤§å¹…æå‡ç•°å¸¸æª¢æ¸¬çš„æº–ç¢ºæ€§ï¼ğŸš€
