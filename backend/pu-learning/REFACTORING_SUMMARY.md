# PU Learning å¼•æ“é‡æ§‹ç¸½çµ

## é‡æ§‹ç›®æ¨™
å°‡ `pulearning_engine.py` ä¸­ uPU å’Œ nnPU æ¼”ç®—æ³•çš„é‡è¤‡ä»£ç¢¼æå–ç‚ºå…±ç”¨å‡½æ•¸ï¼Œæé«˜ä»£ç¢¼çš„å¯ç¶­è­·æ€§å’Œä¸€è‡´æ€§ã€‚

## æå–çš„å…±ç”¨å‡½æ•¸

### 1. è¨“ç·´è³‡è¨Šæ‰“å°å‡½æ•¸
- **`print_common_training_info(algorithm, xp, xu, prior, options)`**
  - åŠŸèƒ½ï¼šæ‰“å°è¨“ç·´çš„å…±åŒè³‡è¨Šï¼ŒåŒ…æ‹¬æ¼”ç®—æ³•é¡å‹ã€æ¨¡å‹æ¶æ§‹ã€æå¤±å‡½æ•¸ç­‰
  - ä½¿ç”¨ï¼šåœ¨ `train_upu` å’Œ `train_nnpu` å‡½æ•¸ä¸­èª¿ç”¨
  - æ•ˆæœï¼šçµ±ä¸€äº†è¨“ç·´é–‹å§‹æ™‚çš„æ—¥èªŒæ ¼å¼

- **`print_upu_parameters(options)`**
  - åŠŸèƒ½ï¼šæ‰“å° uPU ç‰¹å®šçš„è¶…åƒæ•¸é…ç½®
  - ä½¿ç”¨ï¼šåœ¨ `train_upu` å‡½æ•¸ä¸­èª¿ç”¨

- **`print_nnpu_parameters(options)`**
  - åŠŸèƒ½ï¼šæ‰“å° nnPU ç‰¹å®šçš„è¶…åƒæ•¸é…ç½®
  - ä½¿ç”¨ï¼šåœ¨ `train_nnpu` å‡½æ•¸ä¸­èª¿ç”¨

- **`print_device_info()`**
  - åŠŸèƒ½ï¼šæ‰“å°è¨ˆç®—è¨­å‚™è³‡è¨Šï¼ˆCPU/GPUï¼‰
  - ä½¿ç”¨ï¼šåœ¨ `train_nnpu` å‡½æ•¸ä¸­èª¿ç”¨

### 2. æ¨¡å‹åˆ†æå‡½æ•¸
- **`analyze_model_complexity(algorithm, params, input_dim, n_p, n_u)`**
  - åŠŸèƒ½ï¼šåˆ†ææ¨¡å‹è¤‡é›œåº¦ï¼Œè¨ˆç®—åƒæ•¸/æ•¸æ“šæ¯”ä¾‹ï¼Œæä¾›éæ“¬åˆ/æ¬ æ“¬åˆè­¦å‘Š
  - ä½¿ç”¨ï¼šåœ¨ `run_pu_simulation` ä¸­å° uPU å’Œ nnPU åˆ†åˆ¥èª¿ç”¨
  - æ•ˆæœï¼šçµ±ä¸€äº†æ¨¡å‹è¤‡é›œåº¦åˆ†æé‚è¼¯

### 3. æ•¸æ“šåˆ†æå‡½æ•¸
- **`print_test_data_info(xt_p, xt_n, data_params)`**
  - åŠŸèƒ½ï¼šæ‰“å°æ¸¬è©¦æ•¸æ“šè³‡è¨Šï¼ŒåŒ…æ‹¬å½¢ç‹€å’ŒçœŸå¯¦ prior é©—è­‰
  - ä½¿ç”¨ï¼šåœ¨ `run_pu_simulation` ä¸­èª¿ç”¨
  - æ•ˆæœï¼šçµ±ä¸€äº†æ¸¬è©¦æ•¸æ“šçš„æ—¥èªŒæ ¼å¼

### 4. é æ¸¬åˆ†æå‡½æ•¸
- **`print_prediction_analysis(pred_p, pred_n, algorithm)`**
  - åŠŸèƒ½ï¼šåˆ†ææ¨¡å‹é æ¸¬çµæœï¼ŒåŒ…æ‹¬é æ¸¬å€¼ç¯„åœã€åˆ†ä½ˆçµ±è¨ˆã€éåº¦è‡ªä¿¡è­¦å‘Š
  - ä½¿ç”¨ï¼šåœ¨ `run_pu_simulation` ä¸­å° uPU å’Œ nnPU åˆ†åˆ¥èª¿ç”¨
  - æ•ˆæœï¼šçµ±ä¸€äº†é æ¸¬åˆ†æçš„é‚è¼¯å’Œæ ¼å¼

### 5. éŒ¯èª¤ç‡è¨ˆç®—å‡½æ•¸
- **`calculate_error_rates(pred_p, pred_n, xt_p, xt_n, prior, algorithm)`**
  - åŠŸèƒ½ï¼šè¨ˆç®— FNRã€FPR å’ŒåŠ æ¬ŠéŒ¯èª¤ç‡ï¼Œæ‰“å°è©³ç´°çµ±è¨ˆ
  - ä½¿ç”¨ï¼šåœ¨ `run_pu_simulation` ä¸­å° uPU å’Œ nnPU åˆ†åˆ¥èª¿ç”¨
  - æ•ˆæœï¼šçµ±ä¸€äº†éŒ¯èª¤ç‡è¨ˆç®—é‚è¼¯

### 6. è©•ä¼°åˆ†æå‡½æ•¸
- **`analyze_error_rate_reasonableness(error_rate, pred_p, pred_n, algorithm)`**
  - åŠŸèƒ½ï¼šåˆ†æéŒ¯èª¤ç‡çš„åˆç†æ€§ï¼Œæª¢æŸ¥æ˜¯å¦ç•°å¸¸ï¼ˆéä½æˆ–éé«˜ï¼‰
  - ä½¿ç”¨ï¼šåœ¨ `run_pu_simulation` ä¸­å° uPU å’Œ nnPU åˆ†åˆ¥èª¿ç”¨
  - æ•ˆæœï¼šçµ±ä¸€äº†éŒ¯èª¤ç‡åˆç†æ€§æª¢æŸ¥é‚è¼¯

- **`analyze_prior_estimation(estimated_prior, true_prior, algorithm)`**
  - åŠŸèƒ½ï¼šåˆ†æå…ˆé©—ä¼°è¨ˆçš„æº–ç¢ºæ€§ï¼Œæä¾›èª¤å·®è­¦å‘Š
  - ä½¿ç”¨ï¼šåœ¨ `run_pu_simulation` ä¸­å° uPU å’Œ nnPU åˆ†åˆ¥èª¿ç”¨
  - æ•ˆæœï¼šçµ±ä¸€äº†å…ˆé©—ä¼°è¨ˆåˆ†æé‚è¼¯

## é‡æ§‹æ•ˆæœçµ±è¨ˆ

### ä»£ç¢¼æ¸›å°‘
- **ç¸½å…±æ¸›å°‘äº†ç´„ 200 è¡Œé‡è¤‡ä»£ç¢¼**
- uPU éƒ¨åˆ†æ¸›å°‘ç´„ 90 è¡Œ
- nnPU éƒ¨åˆ†æ¸›å°‘ç´„ 110 è¡Œ

### ä¸€è‡´æ€§æå‡
- çµ±ä¸€çš„æ—¥èªŒæ ¼å¼å’Œé¢¨æ ¼
- ä¸€è‡´çš„éŒ¯èª¤è™•ç†é‚è¼¯
- æ¨™æº–åŒ–çš„åˆ†ææµç¨‹
- ç›¸åŒçš„è­¦å‘Šå’Œæç¤ºæ ¼å¼

### å¯ç¶­è­·æ€§æå‡
- ä¿®æ”¹å…±ç”¨é‚è¼¯åªéœ€æ›´æ–°ä¸€å€‹åœ°æ–¹
- æ–°å¢åˆ†æåŠŸèƒ½åªéœ€åœ¨å…±ç”¨å‡½æ•¸ä¸­å¯¦ç¾
- æ›´å®¹æ˜“é€²è¡Œå–®å…ƒæ¸¬è©¦

## run_pu_simulation å‡½æ•¸é‡æ§‹

### é‡æ§‹å‰å•é¡Œ
1. **å¤§é‡é‡è¤‡çš„æ—¥èªŒä»£ç¢¼**ï¼šuPU å’Œ nnPU éƒ¨åˆ†æœ‰å¤§é‡ç›¸åŒçš„æ—¥èªŒæ‰“å°é‚è¼¯
2. **é‡è¤‡çš„æ¨¡å‹åƒæ•¸é…ç½®æ—¥èªŒ**ï¼šå…©å€‹æ¼”ç®—æ³•éƒ½æœ‰è©³ç´°çš„åƒæ•¸æ‰“å°ï¼Œæ ¼å¼ç›¸ä¼¼
3. **é‡è¤‡çš„æ¸¬è©¦é›†åˆ†æ**ï¼šç›¸åŒçš„æ¸¬è©¦é›†åŸºæœ¬ä¿¡æ¯æª¢æŸ¥é‚è¼¯
4. **é‡è¤‡çš„é æ¸¬åˆ†æ**ï¼šç›¸åŒçš„é æ¸¬å€¼ç¯„åœå’Œåˆ†ä½ˆçµ±è¨ˆé‚è¼¯
5. **é‡è¤‡çš„éŒ¯èª¤ç‡è¨ˆç®—**ï¼šç›¸åŒçš„æ··æ·†çŸ©é™£å’ŒéŒ¯èª¤ç‡è¨ˆç®—é‚è¼¯

### é‡æ§‹å¾Œæ”¹é€²
1. **ä½¿ç”¨å…±ç”¨å‡½æ•¸**ï¼š
   - `print_test_data_info()` çµ±ä¸€æ¸¬è©¦æ•¸æ“šæ—¥èªŒ
   - `analyze_model_complexity()` çµ±ä¸€æ¨¡å‹è¤‡é›œåº¦åˆ†æ
   - `print_prediction_analysis()` çµ±ä¸€é æ¸¬åˆ†æ
   - `calculate_error_rates()` çµ±ä¸€éŒ¯èª¤ç‡è¨ˆç®—
   - `analyze_error_rate_reasonableness()` çµ±ä¸€éŒ¯èª¤ç‡åˆç†æ€§åˆ†æ
   - `analyze_prior_estimation()` çµ±ä¸€å…ˆé©—ä¼°è¨ˆåˆ†æ

2. **ä»£ç¢¼ç°¡åŒ–**ï¼š
   - ç§»é™¤äº†é‡è¤‡çš„è©³ç´°æ—¥èªŒä»£ç¢¼
   - ç°¡åŒ–äº†æ¨¡å‹åƒæ•¸é…ç½®éƒ¨åˆ†
   - çµ±ä¸€äº†è¨“ç·´éŒ¯èª¤ç‡è¨ˆç®—é‚è¼¯

3. **åŠŸèƒ½ä¿æŒ**ï¼š
   - æ‰€æœ‰åŸæœ‰åŠŸèƒ½å®Œå…¨ä¿ç•™
   - æ—¥èªŒè¼¸å‡ºæ ¼å¼ä¿æŒä¸€è‡´
   - åˆ†æé‚è¼¯å®Œå…¨ç›¸åŒ

### é‡æ§‹å‰å¾Œå°æ¯”

#### é‡æ§‹å‰ï¼ˆnnPU éƒ¨åˆ†ï¼‰
```python
# è©³ç´°æª¢æŸ¥æ¸¬è©¦é›†
print(f"   ğŸ“‹ æ¸¬è©¦é›†åŸºæœ¬ä¿¡æ¯:")
print(f"      â€¢ æ­£æ¨£æœ¬æ¸¬è©¦é›†å¤§å°: {len(xt_p)}")
print(f"      â€¢ è² æ¨£æœ¬æ¸¬è©¦é›†å¤§å°: {len(xt_n)}")
print(f"      â€¢ æ¸¬è©¦é›†ç¸½æ•¸: {len(xt_p) + len(xt_n)}")
print(f"      â€¢ å¯¦éš›æ¸¬è©¦é›† prior: {len(xt_p) / (len(xt_p) + len(xt_n)):.3f}")

# æª¢æŸ¥æ¸¬è©¦é›†çš„æ•¸å€¼ç¯„åœ
if len(xt_p) > 0:
    xt_p_array = np.array(xt_p)
    print(f"      â€¢ æ­£æ¨£æœ¬ X ç¯„åœ: [{xt_p_array[:, 0].min():.3f}, {xt_p_array[:, 0].max():.3f}]")
    print(f"      â€¢ æ­£æ¨£æœ¬ Y ç¯„åœ: [{xt_p_array[:, 1].min():.3f}, {xt_p_array[:, 1].max():.3f}]")

if len(xt_n) > 0:
    xt_n_array = np.array(xt_n)
    print(f"      â€¢ è² æ¨£æœ¬ X ç¯„åœ: [{xt_n_array[:, 0].min():.3f}, {xt_n_array[:, 0].max():.3f}]")
    print(f"      â€¢ è² æ¨£æœ¬ Y ç¯„åœ: [{xt_n_array[:, 1].min():.3f}, {xt_n_array[:, 1].max():.3f}]")
```

#### é‡æ§‹å¾Œ
```python
# ä½¿ç”¨å…±ç”¨çš„é æ¸¬åˆ†æå‡½æ•¸
print_prediction_analysis(pred_p, pred_n, 'nnPU')
```

## ä½¿ç”¨æ–¹å¼

### åœ¨ train_upu ä¸­ä½¿ç”¨
```python
# ä½¿ç”¨å…±ç”¨çš„è¨“ç·´è³‡è¨Šæ‰“å°å‡½æ•¸
print_common_training_info('uPU', xp, xu, prior, options)
print_upu_parameters(options)
```

### åœ¨ train_nnpu ä¸­ä½¿ç”¨
```python
# ä½¿ç”¨å…±ç”¨çš„è¨“ç·´è³‡è¨Šæ‰“å°å‡½æ•¸
print_common_training_info('nnPU', xp, xu, prior, options)
print_nnpu_parameters(options)
print_device_info()
```

### åœ¨ run_pu_simulation ä¸­ä½¿ç”¨
```python
# ä½¿ç”¨å…±ç”¨çš„æ¸¬è©¦æ•¸æ“šè³‡è¨Šæ‰“å°å‡½æ•¸
print_test_data_info(xt_p, xt_n, data_params)

# ä½¿ç”¨å…±ç”¨çš„æ¨¡å‹è¤‡é›œåº¦åˆ†æå‡½æ•¸
analyze_model_complexity('uPU', options, data_params.dims, len(xp), len(xu))

# ä½¿ç”¨å…±ç”¨çš„é æ¸¬åˆ†æå‡½æ•¸
print_prediction_analysis(pred_p, pred_n, 'uPU')

# ä½¿ç”¨å…±ç”¨çš„éŒ¯èª¤ç‡è¨ˆç®—å‡½æ•¸
error_rate, fn_rate, fp_rate = calculate_error_rates(pred_p, pred_n, xt_p, xt_n, data_params.prior, 'uPU')

# ä½¿ç”¨å…±ç”¨çš„éŒ¯èª¤ç‡åˆç†æ€§åˆ†æå‡½æ•¸
analyze_error_rate_reasonableness(error_rate, pred_p, pred_n, 'uPU')

# ä½¿ç”¨å…±ç”¨çš„å…ˆé©—ä¼°è¨ˆåˆ†æå‡½æ•¸
analyze_prior_estimation(estimated_prior, data_params.prior, 'uPU')
```

## æœªä¾†æ”¹é€²å»ºè­°

### 1. é€²ä¸€æ­¥æ¨¡çµ„åŒ–
- å°‡å…±ç”¨å‡½æ•¸ç§»åˆ°å–®ç¨çš„æ¨¡çµ„ä¸­ï¼ˆå¦‚ `utils.py`ï¼‰
- å‰µå»ºå°ˆé–€çš„æ—¥èªŒæ¨¡çµ„
- åˆ†é›¢é…ç½®ç®¡ç†

### 2. é…ç½®åŒ–
- å°‡æ—¥èªŒç´šåˆ¥è¨­ç‚ºå¯é…ç½®
- å°‡åˆ†æé–¾å€¼è¨­ç‚ºå¯é…ç½®
- æ”¯æ´ä¸åŒçš„è¼¸å‡ºæ ¼å¼

### 3. å–®å…ƒæ¸¬è©¦
- ç‚ºæ¯å€‹å…±ç”¨å‡½æ•¸ç·¨å¯«å–®å…ƒæ¸¬è©¦
- æ¸¬è©¦é‚Šç•Œæƒ…æ³å’Œç•°å¸¸è™•ç†
- ç¢ºä¿é‡æ§‹å¾ŒåŠŸèƒ½å®Œå…¨ä¸€è‡´

### 4. æ–‡æª”å®Œå–„
- ç‚ºæ¯å€‹å…±ç”¨å‡½æ•¸æ·»åŠ è©³ç´°çš„æ–‡æª”å­—ç¬¦ä¸²
- æä¾›ä½¿ç”¨ç¯„ä¾‹
- èªªæ˜åƒæ•¸å’Œè¿”å›å€¼

### 5. æ€§èƒ½å„ªåŒ–
- æ¸›å°‘ä¸å¿…è¦çš„è¨ˆç®—
- å„ªåŒ–æ—¥èªŒè¼¸å‡ºæ€§èƒ½
- è€ƒæ…®ç•°æ­¥æ—¥èªŒè¨˜éŒ„

## ç¸½çµ

æœ¬æ¬¡é‡æ§‹æˆåŠŸæå–äº† 8 å€‹å…±ç”¨å‡½æ•¸ï¼Œæ¸›å°‘äº†ç´„ 200 è¡Œé‡è¤‡ä»£ç¢¼ï¼Œå¤§å¤§æé«˜äº†ä»£ç¢¼çš„å¯ç¶­è­·æ€§å’Œä¸€è‡´æ€§ã€‚`run_pu_simulation` å‡½æ•¸ç¾åœ¨æ›´åŠ ç°¡æ½”ï¼ŒåŒæ™‚ä¿æŒäº†æ‰€æœ‰åŸæœ‰åŠŸèƒ½ã€‚é‡æ§‹å¾Œçš„ä»£ç¢¼æ›´å®¹æ˜“ç†è§£ã€æ¸¬è©¦å’Œç¶­è­·ã€‚ 
